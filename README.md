[Audio panner demo](#audio-panner-demo)  
[PannerNode (rus)](#pannernode)  
[AudioListener (rus)](#audiolistener)  
[Описание демо](#Описание-демо)

#Audio panner demo

Use `[W, A, S, D]` or arrow keys to move the listener (black circle)
around the panner sound source (red circle).
 
Use mouse/touchpad to change listener's orientation,
indicated by the arrow inside the white circle.

Use input fields to change the orientation and
position of the sound source and all the other sound source parameters.

_This demo uses the sound made with Apple GarageBand on an iPhone._

#`PannerNode`

Интерфейс [`PannerNode`](https://webaudio.github.io/web-audio-api/#the-pannernode-interface) — часть [`Web Audio API`](https://webaudio.github.io/web-audio-api/), предназначенная для задания позиции, направления и других характеристик для источника звука в пространстве.
Это потомок [`AudioNode`](https://webaudio.github.io/web-audio-api/#the-audionode-interface) (наследует его ссвойства и методы), для которого можно определить позицию в _правой_ Декартовой системе координат, а также направленность звука с помощью системы конусов.

`PannerNode` обрабатывает только один входной сигнал (моно/стерео), выходной сигнал всегда стерео. Трансформация в правый и левый канал производится относительно положения и направления слушателя — объекта `AudioListener`.

##Положение в пространстве и направление

###Свойства

####`positionX`, `positionY`, `positionZ`
Каждое свойство задает соответствующую координату источника звука в трехмерном пространстве.

Свойства являются экземплярами [AudioParam](https://webaudio.github.io/web-audio-api/#idl-def-AudioParam), то есть `readonly` сами по себе. Чтобы задать их значение, нужно использовать их свойство `value`. По умолчанию все компоненты равны 0 и могут принимать значения (−∞, ∞).

_В FF поддержаны только с [50-й версии](https://bugzilla.mozilla.org/show_bug.cgi?id=1265394), до тех пор для их установки используется устаревший метод `setPosition`._

####`orientationX`, `orientationY`, `orientationZ`
Являются компонентами вектора направления распространения звука от источника в трехмерном пространстве. Направление влияет на то, какой канал, правый или левый, будет звучать громче, а также на уровень громкости звука. Звук, направленный в противоположную от слушателя сторону, может быть заглушен вплоть до полной тишины.

Свойства также являются экземплярами [AudioParam](https://webaudio.github.io/web-audio-api/#idl-def-AudioParam), поэтому чтобы задать их значения напрямую, используют их свойство `value`. По умолчанию все свойства равны 0, кроме `orientationX`, который равен 1. Это значит, что по умолчанию звук направлен вдоль координаты X в воображаемой системе координат. Могут принимать значения (−∞, ∞).

_В FF поддержаны только с [50-й версии](https://bugzilla.mozilla.org/show_bug.cgi?id=1265394), до тех пор для их установки используется устаревший метод `setOrientation`._

####`panningModel`
Определяет алгоритм, по которому звук будет распределяться между правым и левым каналами.

#####`equalpower`
Простой и быстрый алгоритм для разделения каналов.

#####`HRTF` (по умолчанию)
[Human related transfer function](https://en.wikipedia.org/wiki/Head-related_transfer_function) (также [Head-related transfer function](https://webaudio.github.io/web-audio-api/#hrtf-panning-stereo-only)) - более сложный алгоритм, основанный на особенности человека определять позицию звука в 3D-пространстве, используя только два приемника (уха). Дает в целом лучший результат. Может изменять продолжительность звучания источника. 

###Методы

####`setPosition`
**Устаревший**  
Использовался для одновременной установки значений координат источника звука (параметры `x`, `y`, `z`).

####`setOrientation`
**Устаревший**  
Использовался для одновременной установки координат вектора направления источника звука (параметры `x`, `y`, `z`).

##Изменение громкости звука

Громкость звука `PannerNode` может изменяться в двух случаях:
* в зависимости от расстояния между слушателем и источником звука;
* в зависимости от направленности источника звука.

Общий коэффициент изменения громкости звука рассчитывается как произведение составляющих:  
`totalVolumeGain = distanceGain * coneGain`.

###Направленность источника

С помощью параметров `orientationX`, `orientationY`, `orientationZ` для каждого источника звука задается вектор его направления. Но кроме этого для источников задаются параметры широты распространения звука от них, показывающие, на сколько звук, направленный прямо на слушателя, будет громче, чем направленный в сторону. 

####`coneInnerAngle`
Угол конуса в градусах, внутри которого `coneGain` будет равен 1 (уровень громкости не будет уменьшаться). Должен принимать значения в отрезке [0, 360]. Значение по умолчанию — 360 — фактически означает, что звук ненаправлен, то есть равномерно распространяется во все стороны от источника.

####`coneOuterAngle`
Угол конуса в градусах, снаружи которого `coneGain` будет равен значению свойства `coneOuterGain` (т. е. минимальное значение). Должен принимать значения в отрезке [0, 360]. Значение по умолчанию — 360.

В случае, если слушатель находится между внутренним конусом и внешним, `coneGain` постепенно (линейно в зависимости от угла) уменьшается от 1 до `coneOuterGain`.

####`coneOuterGain`
Задает значение `coneGain` для случая, когда слушатель находится снаружи внешнего конуса. По умолчанию равен 0 (то есть звук становится полностью неслышимым) и принимает значения [0, 1].

###Расстояние до источника

Чем дальше слушатель от источника звука, тем меньше для него будет громкость звука из этого источника.

####`distanceModel`
Свойство, определяющее алгоритм изменения громкости звука в зависимости от расстояния до источника. Значение по умолчанию - `inverse`.

Всего доступны три модели для расчета значения `distanceGain` — коэффициента уменьшения громкости звука в зависимости от расстояния до источника.

#####`linear`
`distanceGain = 1 - rolloffFactor * (Math.max(Math.min(distance, maxDistance), refDistance) - refDistance) / (maxDistance - refDistance);`

Если расстояние до источника меньше либо равно `refDistance`, `distanceGain` равен 1. Если расстояние до источника больше либо равно `maxDistance`, `distanceGain` равен `1 - rolloffFactor`.

#####`inverse` (по умолчанию)
`distanceGain = refDistance / (refDistance + rolloffFactor * (Math.max(distance, refDistance) - refDistance));`

Если расстояние до источника меньше либо равно `refDistance`, `distanceGain` равен 1. При увеличении расстояния `distanceGain` стремится к 0. 

#####`exponential`
`distanceGain = Math.pow(Math.max(distance, refDistance) / refDistance, -state.panner.rolloffFactor);`

Если расстояние до источника меньше либо равно `refDistance`, `distanceGain` равен 1. При увеличении расстояния `distanceGain` стремится к 0. 
 
####`maxDistance`
Используется только в `linear` модели и обозначает расстояние от источника звука до слушателя, после которого громкость перестанет уменьшаться. Значение по умолчанию - 10000.

####`refDistance`
Расстояние от источника звука до слушателя, в пределах которого `distanceGain` равен 1 (громкость источника звука не уменьшается). По умолчанию равен 1.

####`rolloffFactor`
Определяет, как быстро уменьшается громкость источника звука при движении слушателя от него. По умолчанию равен 1. Для модели `linear` его значение изменяется в отрезке [0, 1], для других моделей — в интервале [0, ∞). Значения вне указанных интервалов приводятся к допустимым значениям.

#`AudioListener`

Интерфейс [`AudioListener`](https://webaudio.github.io/web-audio-api/#AudioListener) — часть [`Web Audio API`](https://webaudio.github.io/web-audio-api/), предназначенная для задания позиции и направления слушателя в пространстве.
  
##Положение в пространстве

###Свойства

####`positionX`, `positionY`, `positionZ`
Каждое свойство задает соответствующую координату слушателя в трехмерном пространстве.

Являются [AudioParam](https://webaudio.github.io/web-audio-api/#idl-def-AudioParam), поэтому чтобы задать их напрямую, устанавливают их свойство `value`. По умолчанию все равны 0 и могут принимать значения (−∞, ∞).

###Методы

####`setPosition`
**Устаревший**  
Использовался для одновременной установки значений координат источника звука (параметры `x`, `y`, `z`).

##Направление

###Свойства

Направление задается двумя векторами — `forward` и `up`.

####`forwardX`, `forwardY`, `forwardZ`
Вектор `forward` направлен прямо от слушателя, грубо говоря, туда, куда направлен его нос. По умолчанию вектор `forward` принимает значение (0, 0, -1) (нос направлен против оси Z), а его компоненты могут принимать значения (−∞, ∞).

####`upX`, `upY`, `upZ`
Вектор `up` ортогонален вектору `forward` и направлен в сторону макушки головы слушателя. Значение по умолчанию — (0, 1, 0) (голова направлена по оси Y). Компоненты могут принимать значения (−∞, ∞).

Разработчик должен обеспечить условие линейной независимости векторов `forward` и `up`, чтобы получить предсказуемый результат работы API.

###Методы

####`setOrientation`
**Устаревший**
Использовался для одновременного задания векторов `forward` и `up` (параметры `x`, `y`, `z`, `xUp`, `yUp`, `zUp`)

#Описание демо

Демо показывает, как изменяется уровень громкости звука в правом и левом канале в зависимости от расположения, направления и других параметров источника звука в двумерном пространстве.

##Поле

На поле схематично изображены слушатель (объект `AudioListener`) и один источник звука (объект `PannerNode`). Объекты спроецированы на плоскость XY, мы смотрим на них «сверху». Значение координаты Z для всех объектов для простоты принято равным 0.

Система координат поля — правая: ось X направлена направо, ось Y — вверх, ось Z — на нас.  
*Замечание: это отличается от левой системы координат `css`, в которой ось Y напралена вниз.*

###Слушатель

Показан черным кружком со стрелкой, которая обозначает направление его головы. Считаем, что левое и правое ухо слушателя находятся соответственно по левую и правую стороны стрелки.

Положение слушателя управляется с клавиатуры с помощью стрелок или клавиш `[W, A, S, D]`. Направление головы управляется положением курсора.

###Источник звука

Показан красным кружком со стрелкой, которая обозначает направление распространения звука.

Темно-серый сектор вокруг кружка обозначает область снаружи `coneOuterAngle`, в которой звук наиболее тихий (коэффициент уменьшения его громкости задается в `coneOuterGain`).

Белый сектор обозначает область внутри `coneInnerAngle`, в которой исходный уровень звука не изменяется (зависит только от расстояния от источника).

Светло-серый сектор обозначает область, в которой звук постепенно затихает при движении от белой зоны к темно-серой.

Светло-красный круг вокруг источника обозначает область, ограниченную расстоянием `refDistance`.

Желтый круг вокруг источника обозначает границу `maxDistance` (появляется только при выборе значения `linear` параметра `distanceModel`).

Большинство параметров источника звука можно изменить, редактируя значения в соответствующих полях формы в разделе `PannerNode`.

##Форма

Слева от поля расположена форма, в которой показаны значения параметров объектов `PannerNode` и `AudioListener`. 

Для удобства в разделе `PannerNode` добавлено поле `angle`, показывающее угол поворота источника звука в градусах на плоскости XY, а также в разделе `AudioListener` добавлено поле `angleForward`, показывающее угол поворота головы слушателя в градусах на плоскости XY.

Кроме того, в разделе `Volume gains` показаны расчетные значения коэффициентов уменьшения громкости в зависимости от расстояния — `distanceGain`, направления — `coneGain` и результат их произведения — `totalVolumeGain`.

Иконка c динамиком в правом верхнем углу формы включает/выключает звук.

